# 게임 기능 확장 계획서

이 문서는 현재의 클라이언트 사이드 RPG 게임을 여러 사용자가 즐길 수 있는 온라인 게임으로 확장하기 위한 개발 계획을 담고 있습니다.

## 1. 최종 목표

- **사용자 인증**: 여러 사용자가 회원가입 및 로그인을 통해 자신만의 계정으로 게임을 즐길 수 있습니다.
- **게임 저장 및 불러오기**: 사용자는 게임 진행 상황을 서버에 저장하고, 언제든지 이어서 플레이할 수 있습니다.
- **스코어보드**: 게임 오버 시 최종 점수(도달한 층, 레벨 등)를 기록하고, 모든 사용자의 순위를 볼 수 있는 리더보드를 제공합니다.

## 2. 기술 스택 제안

현재 게임은 HTML, CSS, JavaScript로만 구성되어 있습니다. 위 기능들을 구현하기 위해서는 서버와 데이터베이스가 필요합니다.

- **백엔드 (서버)**: **Node.js** 와 **Express** 프레임워크
  - 기존 코드가 JavaScript 기반이므로, 같은 언어인 Node.js를 사용하면 개발 연속성을 유지하기 좋습니다.
- **데이터베이스**: **MongoDB**
  - 게임 캐릭터의 상태(JSON 객체)를 유연하게 저장하고 수정하기에 적합한 NoSQL 데이터베이스입니다.
- **인증 방식**: **JWT (JSON Web Token)**
  - 사용자가 로그인했을 때 서버가 토큰을 발급하고, 클라이언트는 이후 요청마다 이 토큰을 함께 보내 사용자를 인증하는 방식입니다.

## 3. 개발 단계별 계획

### 1단계: 백엔드(서버) 기본 구축

1.  **서버 환경 설정**:
    -   Node.js와 Express를 사용하여 기본적인 웹 서버를 구축합니다.
    -   프로젝트 폴더에 `server.js` 같은 서버 진입점 파일을 생성합니다.
2.  **데이터베이스 설계**:
    -   MongoDB를 연결하고, Mongoose 같은 라이브러리를 사용하여 데이터 모델을 정의합니다.
    -   필요한 모델:
        -   `User`: 사용자 정보 (아이디, 비밀번호 등)
        -   `GameState`: 사용자의 게임 저장 데이터 (`player` 객체, 현재 층 등)
        -   `Score`: 사용자의 최고 점수 기록
3.  **API 엔드포인트 설계**:
    -   클라이언트와 서버가 통신할 수 있도록 아래와 같은 API를 설계합니다.
      - `POST /api/users/register` (회원가입)
      - `POST /api/users/login` (로그인)
      - `POST /api/game/save` (게임 저장)
      - `GET /api/game/load` (게임 불러오기)
      - `POST /api/scores` (점수 등록)
      - `GET /api/scores` (스코어보드 조회)

### 2단계: 사용자 인증 기능 구현

1.  **UI 추가**:
    -   `index.html`에 로그인 및 회원가입을 위한 간단한 폼(form)을 모달 창 형태로 추가합니다.
    -   게임 시작 화면에서 "로그인" 또는 "새 게임 시작"을 선택할 수 있도록 UI를 변경합니다.
2.  **인증 로직 구현**:
    -   사용자가 로그인에 성공하면 서버로부터 JWT 토큰을 받아 브라우저의 `localStorage`에 저장합니다.
    -   게임 저장, 불러오기 등 인증이 필요한 API를 요청할 때, 저장된 토큰을 HTTP 헤더에 담아 함께 전송합니다.
    -   서버는 이 토큰을 검증하여 해당 사용자의 요청을 처리합니다.

### 3단계: 게임 저장 및 불러오기 기능 구현

1.  **클라이언트 로직 수정 (`script.js`)**:
    -   **게임 상태 직렬화**: 현재 게임의 모든 상태(`player` 객체, `floor`, `turn` 등)를 하나의 JSON 객체로 만드는 함수를 작성합니다.
    -   **저장 기능**: "저장" 버튼을 UI에 추가합니다. 버튼 클릭 시, 직렬화된 게임 상태를 `/api/game/save` API로 전송합니다.
    -   **불러오기 기능**: 사용자가 로그인했을 때, `/api/game/load` API를 호출하여 저장된 게임 데이터가 있는지 확인합니다. 데이터가 있으면 해당 정보로 `player` 객체와 게임 변수들을 복원하고, `updateUI()`를 호출하여 화면을 갱신합니다.
2.  **서버 로직 구현**:
    -   `/api/game/save`: 클라이언트로부터 받은 게임 상태 데이터를 인증된 사용자의 `GameState`에 저장(또는 덮어쓰기)합니다.
    -   `/api/game/load`: 인증된 사용자의 `GameState`를 데이터베이스에서 찾아 클라이언트로 전송합니다.

### 4단계: 스코어보드 기능 구현

1.  **점수 전송 로직 추가 (`script.js`)**:
    -   `gameOver()` 함수가 호출될 때, 최종 점수(예: `floor`, `level`)를 `/api/scores` API로 전송합니다.
2.  **서버 로직 구현**:
    -   `/api/scores` (POST): 전송된 점수를 해당 유저의 기존 최고 점수와 비교하여, 더 높을 경우에만 `Score` 모델을 업데이트합니다.
    -   `/api/scores` (GET): `Score` 모델에서 모든 사용자의 점수를 높은 순으로 정렬하여 클라이언트로 전송합니다.
3.  **스코어보드 UI 추가**:
    -   "스코어보드" 버튼과 순위를 표시할 모달 창을 `index.html`에 추가합니다.
    -   버튼 클릭 시 `/api/scores` API를 호출하여 데이터를 받아와 순위 목록을 화면에 렌더링합니다.

## 4. 기존 코드 변경점 예상

- **`script.js`**:
  - `startGame()`: 로그인 후 저장된 데이터가 있는지 확인하고, 있으면 불러오는 로직이 추가되어야 합니다.
  - `gameOver()`: 게임 오버 시 점수를 서버로 전송하는 로직이 추가되어야 합니다.
  - 전역 변수로 관리되던 `player`, `floor` 등의 상태를 하나의 객체로 묶어 관리하면 저장/불러오기가 더 용이해집니다.
- **`ui.js`**:
  - 로그인/회원가입, 스코어보드 모달을 열고 닫는 함수가 추가되어야 합니다.
  - "저장" 버튼과 관련된 UI 로직이 필요합니다.
- **`index.html`**:
  - 새로운 모달 창들과 버튼들의 HTML 구조가 추가되어야 합니다.

## 5. 향후 고려사항

- **보안**: 사용자 비밀번호는 반드시 암호화(해싱)하여 데이터베이스에 저장해야 합니다.
- **유효성 검사**: 클라이언트와 서버 양쪽에서 사용자 입력값(아이디, 비밀번호 등)에 대한 유효성 검사를 철저히 해야 합니다.
- **배포**: 완성된 애플리케이션(프론트엔드 + 백엔드)을 Heroku, AWS, Vercel 등의 클라우드 플랫폼에 배포하는 과정을 계획해야 합니다.